<!-- 出库管理 -->
<div class="content-section active" id="outbound">
    <div class="header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-0"><i class="fas fa-dolly me-2"></i>出库管理</h2>
            </div>
            <div class="d-flex">
                <div class="input-group me-3" style="width: 300px;">
                    <input type="text" class="form-control" placeholder="搜索商品或订单...">
                    <button class="btn btn-outline-secondary" type="button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="dropdown me-3">
                    <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <span class="notification-icon">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </span>
                    </button>
                </div>
                <div>
                    <button class="btn btn-primary" id="generateOutboundBtn">
                        <i class="fas fa-plus me-2"></i>新建出库单
                    </button>
                </div>
            </div>
        </div>
    </div>

   
    <div class="row">
        <div class="col-lg-8">
            <!-- 出库单生成区域 -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>出库单详情</span>
                    <div>
                        <button class="btn btn-sm btn-light me-2" id="printBtn">
                            <i class="fas fa-print me-1"></i>打印
                        </button>
                        <button class="btn btn-sm btn-success" id="downloadBtn">
                            <i class="fas fa-download me-1"></i>下载CSV
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="outboundDetails">
                        <div class="outbound-card">
                            <div class="outbound-header">
                                <div class="outbound-title">百姓超市 - 商品出库单</div>
                                <div class="outbound-number">单号: <span id="outboundNumber">CK20230615001</span></div>
                            </div>

                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div><strong>出库日期:</strong> <span id="outboundDate">2023-06-15</span></div>
                                    <div><strong>仓库:</strong> 中心仓库</div>
                                    <div><strong>操作员:</strong> 张经理</div>
                                </div>
                                <div class="col-md-6 text-end">
                                    <div><strong>状态:</strong> <span class="status-badge status-pending">待出库</span></div>
                                    <div><strong>备注:</strong> 门店补货</div>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-hover" id="outboundTable">
                                    <thead>
                                        <tr>
                                            <th>商品条码</th>
                                            <th>商品名称</th>
                                            <th>规格</th>
                                            <th>单位</th>
                                            <th>单价</th>
                                            <th>出库数量</th>
                                            <th>金额</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>6923450656188</td>
                                            <td>可口可乐</td>
                                            <td>330ml*24</td>
                                            <td>箱</td>
                                            <td>¥48.00</td>
                                            <td>5</td>
                                            <td>¥240.00</td>
                                        </tr>
                                        <tr>
                                            <td>6940159430192</td>
                                            <td>农夫山泉</td>
                                            <td>550ml*24</td>
                                            <td>箱</td>
                                            <td>¥30.00</td>
                                            <td>8</td>
                                            <td>¥240.00</td>
                                        </tr>
                                        <tr>
                                            <td>6925303770563</td>
                                            <td>康师傅红烧牛肉面</td>
                                            <td>桶装*12</td>
                                            <td>箱</td>
                                            <td>¥45.00</td>
                                            <td>4</td>
                                            <td>¥180.00</td>
                                        </tr>
                                        <tr>
                                            <td>6924187826188</td>
                                            <td>奥利奥夹心饼干</td>
                                            <td>116g*24</td>
                                            <td>箱</td>
                                            <td>¥60.00</td>
                                            <td>3</td>
                                            <td>¥180.00</td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="6" class="text-end fw-bold">总计:</td>
                                            <td class="fw-bold">¥840.00</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <div class="mt-4">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>制单人:</strong> 张经理
                                    </div>
                                    <div>
                                        <strong>审核人:</strong> 王主管
                                    </div>
                                    <div>
                                        <strong>出库人:</strong> 李仓库员
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- 操作面板 -->
            <div class="card">
                <div class="card-header">操作</div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary mb-2" id="confirmBtn">
                            <i class="fas fa-check-circle me-2"></i>确认出库
                        </button>
                        <button class="btn btn-outline-primary mb-2" data-bs-toggle="modal" data-bs-target="#editModal">
                            <i class="fas fa-edit me-2"></i>修改出库单
                        </button>
                        <button class="btn btn-outline-secondary mb-2" id="previewBtn">
                            <i class="fas fa-print me-2"></i>打印预览
                        </button>
                        <button class="btn btn-outline-success mb-2" id="exportExcelBtn">
                            <i class="fas fa-file-export me-2"></i>导出Excel
                        </button>
                        <button class="btn btn-outline-danger" id="deleteBtn">
                            <i class="fas fa-trash-alt me-2"></i>删除出库单
                        </button>
                    </div>

                    <div class="mt-4">
                        <h5><i class="fas fa-info-circle me-2"></i>操作说明</h5>
                        <ul class="mt-3">
                            <li>确认出库后，系统将自动扣减库存</li>
                            <li>下载CSV格式可用于外部系统导入</li>
                            <li>导出Excel将保留完整格式</li>
                            <li>删除出库单需管理员权限</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 最近出库单 -->
            <div class="card mt-4">
                <div class="card-header">最近出库单</div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <div>CK20230614003</div>
                                <small class="text-muted">2023-06-14</small>
                            </div>
                            <span class="badge bg-success">已完成</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <div>CK20230614002</div>
                                <small class="text-muted">2023-06-14</small>
                            </div>
                            <span class="badge bg-success">已完成</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <div>CK20230614001</div>
                                <small class="text-muted">2023-06-14</small>
                            </div>
                            <span class="badge bg-warning">处理中</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <div>CK20230613005</div>
                                <small class="text-muted">2023-06-13</small>
                            </div>
                            <span class="badge bg-success">已完成</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer mt-4 text-center">
    <p>© 2023 百姓超市仓库管理系统 | 技术支持: 400-888-8888</p>
</div>

<!-- 打印模态框 -->
<div class="print-modal" id="printModal">
    <span class="close-modal" id="closeModal">&times;</span>
    <div class="print-content">
        <div class="print-header">
            <div class="store-name">百姓超市</div>
            <div class="subtitle">商品出库单</div>
        </div>

        <div class="print-section">
            <div class="outbound-card">
                <div class="outbound-header">
                    <div class="outbound-title">出库单详情</div>
                    <div class="outbound-number">单号: <span id="printOutboundNumber">CK20230615001</span></div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div><strong>出库日期:</strong> <span id="printOutboundDate">2023-06-15</span></div>
                        <div><strong>仓库:</strong> 中心仓库</div>
                        <div><strong>操作员:</strong> 张经理</div>
                    </div>
                    <div class="col-md-6 text-end">
                        <div><strong>状态:</strong> <span class="status-badge status-pending">待出库</span></div>
                        <div><strong>备注:</strong> 门店补货</div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table print-table">
                        <thead>
                            <tr>
                                <th>商品条码</th>
                                <th>商品名称</th>
                                <th>规格</th>
                                <th>单位</th>
                                <th>单价</th>
                                <th>出库数量</th>
                                <th>金额</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>6923450656188</td>
                                <td>可口可乐</td>
                                <td>330ml*24</td>
                                <td>箱</td>
                                <td>¥48.00</td>
                                <td>5</td>
                                <td>¥240.00</td>
                            </tr>
                            <tr>
                                <td>6940159430192</td>
                                <td>农夫山泉</td>
                                <td>550ml*24</td>
                                <td>箱</td>
                                <td>¥30.00</td>
                                <td>8</td>
                                <td>¥240.00</td>
                            </tr>
                            <tr>
                                <td>6925303770563</td>
                                <td>康师傅红烧牛肉面</td>
                                <td>桶装*12</td>
                                <td>箱</td>
                                <td>¥45.00</td>
                                <td>4</td>
                                <td>¥180.00</td>
                            </tr>
                            <tr>
                                <td>6924187826188</td>
                                <td>奥利奥夹心饼干</td>
                                <td>116g*24</td>
                                <td>箱</td>
                                <td>¥60.00</td>
                                <td>3</td>
                                <td>¥180.00</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6" class="text-end fw-bold">总计:</td>
                                <td class="fw-bold">¥840.00</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-label">制单人</div>
                        <div class="info-value">张经理</div>
                        <div class="signature-line"></div>
                        <div class="signature-label">签字</div>
                    </div>
                    <div class="signature-box">
                        <div class="signature-label">审核人</div>
                        <div class="info-value">王主管</div>
                        <div class="signature-line"></div>
                        <div class="signature-label">签字</div>
                    </div>
                    <div class="signature-box">
                        <div class="signature-label">出库人</div>
                        <div class="info-value">李仓库员</div>
                        <div class="signature-line"></div>
                        <div class="signature-label">签字</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="print-notice">
            <i class="fas fa-info-circle"></i>打印提示：点击下方按钮可预览或直接打印出库单。打印时请确保打印机有足够纸张。
        </div>

        <div class="action-buttons">
            <button class="btn-print" id="modalPreviewBtn">
                <i class="fas fa-eye"></i>打印预览
            </button>
            <button class="btn-print" id="modalPrintBtn">
                <i class="fas fa-print"></i>直接打印
            </button>
        </div>

        <div class="footer">
            <p>© 2023 百姓超市仓库管理系统 | 系统生成时间: 2023-06-15 14:30:45</p>
        </div>
    </div>
</div>

<!-- 修改出库单模态框 -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel"><i class="fas fa-edit me-2"></i>修改出库单</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form class="edit-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>出库单号</label>
                                <input type="text" class="form-control" value="CK20230615001" readonly>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>出库日期</label>
                                <input type="date" class="form-control" value="2023-06-15">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>仓库</label>
                                <select class="form-select">
                                    <option selected>中心仓库</option>
                                    <option>城东分仓</option>
                                    <option>城西分仓</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>操作员</label>
                                <input type="text" class="form-control" value="张经理">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>备注</label>
                        <textarea class="form-control" rows="2">门店补货</textarea>
                    </div>

                    <div class="mt-4">
                        <h5><i class="fas fa-boxes me-2"></i>出库商品</h5>
                        <div class="table-responsive mt-3">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>商品条码</th>
                                        <th>商品名称</th>
                                        <th>库存数量</th>
                                        <th>出库数量</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>6923450656188</td>
                                        <td>可口可乐</td>
                                        <td>42箱</td>
                                        <td>
                                            <input type="number" class="form-control form-control-sm" value="5" min="1" max="42">
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>6940159430192</td>
                                        <td>农夫山泉</td>
                                        <td>35箱</td>
                                        <td>
                                            <input type="number" class="form-control form-control-sm" value="8" min="1" max="35">
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>6925303770563</td>
                                        <td>康师傅红烧牛肉面</td>
                                        <td>120箱</td>
                                        <td>
                                            <input type="number" class="form-control form-control-sm" value="4" min="1" max="120">
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>6924187826188</td>
                                        <td>奥利奥夹心饼干</td>
                                        <td>86箱</td>
                                        <td>
                                            <input type="number" class="form-control form-control-sm" value="3" min="1" max="86">
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-group mt-3">
                        <label>添加商品</label>
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="输入商品条码或名称">
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="fas fa-search"></i> 搜索
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary">保存修改</button>
            </div>
        </div>
    </div>
</div>

<script>
        $(document).ready(function() {
            // 菜单切换功能
            $('.nav-link').click(function(e) {
                e.preventDefault();

                // 更新活动菜单
                $('.nav-link').removeClass('active');
                $(this).addClass('active');

                // 显示对应内容
                const target = $(this).data('target');
                $('.content-section').removeClass('active');
                $('#' + target).addClass('active');
            });

            // 生成出库单按钮
            $("#generateOutboundBtn").click(function() {
                // 模拟生成新的出库单号
                const today = new Date();
                const dateStr = today.getFullYear() +
                                ('0' + (today.getMonth() + 1)).slice(-2) +
                                ('0' + today.getDate()).slice(-2);
                const randomNum = Math.floor(Math.random() * 100).toString().padStart(3, '0');
                const newOutboundNum = "CK" + dateStr + randomNum;

                // 更新出库单号
                $("#outboundNumber, #printOutboundNumber").text(newOutboundNum);

                // 更新日期
                const dateText = today.toISOString().split('T')[0];
                $("#outboundDate, #printOutboundDate").text(dateText);

                // 显示成功消息
                showAlert("出库单已生成！单号: " + newOutboundNum, "success");
            });

            // 下载CSV按钮
            $("#downloadBtn").click(function() {
                // 显示成功消息
                showAlert("出库单已下载为CSV文件！", "success");

                // 实际项目中这里会生成CSV文件并下载
                // 这里仅做模拟
                const data = [];
                const headers = ["商品条码", "商品名称", "规格", "单位", "单价", "出库数量", "金额"];
                data.push(headers);

                $("#outboundTable tbody tr").each(function() {
                    const row = [];
                    $(this).find('td').each(function() {
                        row.push($(this).text());
                    });
                    data.push(row);
                });

                // 实际项目中这里会生成CSV文件并下载
                console.log("CSV数据:", data);
            });

            // 导出Excel按钮
            $("#exportExcelBtn").click(function() {
                // 获取表格数据
                const table = document.getElementById('outboundTable');
                const workbook = XLSX.utils.table_to_book(table, {sheet: "出库单"});

                // 导出Excel文件
                XLSX.writeFile(workbook, '出库单_CK20230615001.xlsx');

                // 显示成功消息
                showAlert("出库单已导出为Excel文件！", "success");
            });

            // 确认出库按钮
            $("#confirmBtn").click(function() {
                // 更新状态为已完成
                $(".status-badge").removeClass("status-pending").addClass("status-completed").text("已完成");

                // 更新按钮状态
                $(this).html('<i class="fas fa-check-circle me-2"></i>出库完成').addClass('btn-success').removeClass('btn-primary');

                // 显示成功消息
                showAlert("出库操作已完成！库存已更新。", "success");
            });

            // 删除出库单按钮
            $("#deleteBtn").click(function() {
                if (confirm("确定要删除此出库单吗？此操作不可恢复！")) {
                    // 模拟删除操作
                    showAlert("出库单已成功删除！", "success");

                    // 重置表单
                    setTimeout(() => {
                        $("#generateOutboundBtn").click();
                        $("#confirmBtn").html('<i class="fas fa-check-circle me-2"></i>确认出库').addClass('btn-primary').removeClass('btn-success');
                        $(".status-badge").removeClass("status-completed").addClass("status-pending").text("待出库");
                    }, 1000);
                }
            });

            // 打印按钮
            $("#printBtn, #previewBtn").click(function() {
                // 显示打印模态框
                $("#printModal").show();
                document.body.style.overflow = 'hidden';
            });

            // 关闭打印模态框
            $("#closeModal").click(function() {
                $("#printModal").hide();
                document.body.style.overflow = 'auto';
            });

            // 点击模态框外部关闭
            $("#printModal").click(function(e) {
                if (e.target === this) {
                    $(this).hide();
                    document.body.style.overflow = 'auto';
                }
            });

            // 模态框内的打印按钮
            $("#modalPrintBtn").click(function() {
                window.print();
            });

            // 打印预览按钮
            $("#modalPreviewBtn").click(function() {
                alert("请使用浏览器的打印预览功能（通常快捷键为 Ctrl+P）。在打印对话框中，您可以选择打印机和设置打印选项。");
            });

            // 显示提示消息
            function showAlert(message, type) {
                // 移除现有提示
                $(".alert-dismissible").remove();

                // 创建提示元素
                const alertClass = type === "success" ? "alert-success" : "alert-danger";
                const alertHtml = `
                    <div class="alert ${alertClass} alert-dismissible fade show position-fixed top-0 end-0 m-3" style="z-index: 1050;">
                        <strong>${type === "success" ? "成功!" : "错误!"}</strong> ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;

                // 添加到页面
                $("body").append(alertHtml);

                // 5秒后自动消失
                setTimeout(() => {
                    $(".alert-dismissible").alert('close');
                }, 5000);
            }

            // 初始化页面
            $("#generateOutboundBtn").click();
        });
</script>